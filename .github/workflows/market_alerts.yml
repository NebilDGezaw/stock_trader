name: Market Alerts

on:
  # â”€â”€ Scheduled sessions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  schedule:
    # LONDON SESSION: 8:00 AM UTC (Mon-Fri)
    - cron: "0 8 * * 1-5"

    # NEW YORK SESSION: 9:30 AM ET = 14:30 UTC (Mon-Fri)
    - cron: "30 14 * * 1-5"

  # â”€â”€ Manual trigger (for testing) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  workflow_dispatch:
    inputs:
      scan_type:
        description: "What to scan"
        required: false
        default: "all"
        type: choice
        options:
          - stocks_private
          - london_group
          - ny_group
          - all

jobs:
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  #  PRIVATE DM: Stocks only (daily at NY open)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  stocks-private:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    if: >-
      github.event.schedule == '30 14 * * 1-5' ||
      github.event.inputs.scan_type == 'stocks_private' ||
      github.event.inputs.scan_type == 'all'

    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"
          cache: "pip"
      - run: pip install yfinance pandas numpy

      - name: "ðŸ›ï¸ Stocks â†’ Private DM"
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: >-
          python -m alerts.telegram_bot
          --tickers MSTU MSTR MSTZ TSLL SPY AAPL MSFT TSLA GOOGL NVDA META
          --stock-mode
          --always-report MSTU MSTR MSTZ TSLL
          --label "ðŸ›ï¸ US Stocks â€” NY Open"
          --interval 1d --period 6mo

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  #  GROUP: London Session
  #  Forex (EUR/USD, GBP/USD, EUR/GBP, GBP/JPY, USD/CHF)
  #  + Gold & Silver
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  london-group:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    if: >-
      github.event.schedule == '0 8 * * 1-5' ||
      github.event.inputs.scan_type == 'london_group' ||
      github.event.inputs.scan_type == 'all'

    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"
          cache: "pip"
      - run: pip install yfinance pandas numpy

      - name: "ðŸ‡¬ðŸ‡§ London Session â†’ Group"
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_GROUP_CHAT_ID }}
        run: >-
          python -m alerts.telegram_bot
          --tickers EURUSD=X GBPUSD=X EURGBP=X GBPJPY=X USDCHF=X GC=F SI=F
          --label "ðŸ‡¬ðŸ‡§ London Session â€” Forex & Metals"
          --interval 1h --period 1mo

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  #  GROUP: New York Session
  #  Crypto (BTC, ETH, SOL, XRP) + Gold & Silver
  #  + NY Forex (USD/JPY, USD/CAD, USD/CHF, GBP/USD)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ny-group:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    if: >-
      github.event.schedule == '30 14 * * 1-5' ||
      github.event.inputs.scan_type == 'ny_group' ||
      github.event.inputs.scan_type == 'all'

    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"
          cache: "pip"
      - run: pip install yfinance pandas numpy

      - name: "ðŸ‡ºðŸ‡¸ NY Session â†’ Group"
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_GROUP_CHAT_ID }}
        run: >-
          python -m alerts.telegram_bot
          --tickers GC=F SI=F BTC-USD ETH-USD SOL-USD XRP-USD USDJPY=X USDCAD=X USDCHF=X GBPUSD=X
          --label "ðŸ‡ºðŸ‡¸ NY Session â€” Crypto, Metals & Forex"
          --interval 1h --period 1mo
